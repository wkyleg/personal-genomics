<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Genomics Dashboard</title>
    <style>
        /* ========================================
           CSS Variables & Theme
           ======================================== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --accent-primary: #4f46e5;
            --accent-secondary: #818cf8;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius: 12px;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }
        
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.4);
        }
        
        /* ========================================
           Reset & Base
           ======================================== */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ========================================
           Layout
           ======================================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 2rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo svg {
            width: 40px;
            height: 40px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.5rem 0;
            position: sticky;
            top: 96px;
            z-index: 90;
        }
        
        .nav-links {
            display: flex;
            gap: 0.25rem;
            overflow-x: auto;
            padding-bottom: 0.25rem;
            -webkit-overflow-scrolling: touch;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: var(--text-secondary);
            border-radius: 6px;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .nav-link:hover, .nav-link.active {
            background: var(--accent-primary);
            color: white;
        }
        
        main {
            padding: 2rem 0;
        }
        
        /* ========================================
           Components
           ======================================== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        
        .card-header:hover {
            background: var(--bg-secondary);
        }
        
        .card-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .card.collapsed .card-body {
            display: none;
        }
        
        .chevron {
            transition: transform 0.2s;
        }
        
        .card.collapsed .chevron {
            transform: rotate(-90deg);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-danger { background: rgba(220,38,38,0.15); color: var(--danger); }
        .badge-warning { background: rgba(245,158,11,0.15); color: var(--warning); }
        .badge-success { background: rgba(16,185,129,0.15); color: var(--success); }
        .badge-info { background: rgba(59,130,246,0.15); color: var(--info); }
        .badge-neutral { background: var(--bg-secondary); color: var(--text-secondary); }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--accent-secondary);
        }
        
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
        }
        
        .input {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
            width: 100%;
            max-width: 300px;
        }
        
        .input:focus {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }
        
        /* ========================================
           Alert Boxes
           ======================================== */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }
        
        .alert-critical {
            background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(220,38,38,0.05));
            border: 2px solid var(--danger);
        }
        
        .alert-high {
            background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
            border: 2px solid var(--warning);
        }
        
        .alert-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .alert-content h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .alert-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .alert-recommendations {
            margin-top: 0.5rem;
            padding-left: 1rem;
        }
        
        .alert-recommendations li {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        /* ========================================
           Tables
           ======================================== */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background: var(--bg-secondary);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }
        
        tr:hover {
            background: var(--bg-secondary);
        }
        
        .mono {
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        /* ========================================
           Stats Grid
           ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.25rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
            line-height: 1.2;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        /* ========================================
           PRS Visualizations
           ======================================== */
        .prs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .prs-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .prs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .prs-name {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .prs-percentile {
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .prs-bar-container {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .prs-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .prs-marker {
            position: absolute;
            top: -4px;
            width: 3px;
            height: 16px;
            background: var(--text-primary);
            border-radius: 2px;
            transform: translateX(-50%);
        }
        
        .prs-scale {
            display: flex;
            justify-content: space-between;
            font-size: 0.625rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        .prs-confidence {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        /* ========================================
           Trait Cards
           ======================================== */
        .trait-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .trait-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            gap: 0.75rem;
        }
        
        .trait-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--accent-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.25rem;
        }
        
        .trait-content h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .trait-content p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .trait-content .gene {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--accent-primary);
        }
        
        /* ========================================
           Gauge Charts
           ======================================== */
        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        
        .gauge {
            position: relative;
            width: 200px;
            height: 100px;
        }
        
        .gauge svg {
            width: 100%;
            height: 100%;
        }
        
        .gauge-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        
        .gauge-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .gauge-title {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* ========================================
           Food Matrix
           ======================================== */
        .food-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        
        .food-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .food-icon {
            font-size: 1.5rem;
        }
        
        .food-info h5 {
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .food-info p {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .food-status {
            margin-left: auto;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .food-status.good { background: var(--success); }
        .food-status.moderate { background: var(--warning); }
        .food-status.poor { background: var(--danger); }
        
        /* ========================================
           Ancestry Section
           ======================================== */
        .ancestry-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        /* ========================================
           Population Comparison Styles
           ======================================== */
        .pop-comparison-container {
            margin-bottom: 2rem;
        }
        
        .pop-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .pop-tab {
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        
        .pop-tab.active {
            background: var(--accent-primary);
            color: white;
        }
        
        .pop-tab-content {
            display: none;
        }
        
        .pop-tab-content.active {
            display: block;
        }
        
        .pop-bar-container {
            margin: 0.5rem 0;
        }
        
        .pop-bar-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }
        
        .pop-bar-track {
            height: 20px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .pop-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .pop-bar-fill.eur { background: linear-gradient(90deg, #4f46e5, #818cf8); }
        .pop-bar-fill.afr { background: linear-gradient(90deg, #059669, #34d399); }
        .pop-bar-fill.eas { background: linear-gradient(90deg, #dc2626, #f87171); }
        .pop-bar-fill.sas { background: linear-gradient(90deg, #d97706, #fbbf24); }
        .pop-bar-fill.amr { background: linear-gradient(90deg, #7c3aed, #a78bfa); }
        
        .pop-flag {
            font-size: 1.25rem;
            margin-right: 0.5rem;
        }
        
        .similarity-ranking {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .similarity-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .similarity-rank {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            width: 40px;
            text-align: center;
        }
        
        .similarity-info {
            flex: 1;
        }
        
        .similarity-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .similarity-superpop {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .similarity-score {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--accent-primary);
        }
        
        .marker-detail-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .marker-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .marker-rsid {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .marker-gene {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--accent-primary);
        }
        
        .marker-trait {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .marker-genotype-badge {
            background: var(--accent-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-weight: 600;
        }
        
        /* ========================================
           Ancient DNA Timeline Styles
           ======================================== */
        .ancient-timeline {
            position: relative;
            padding-left: 2rem;
            margin: 2rem 0;
        }
        
        .ancient-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 1.5rem;
        }
        
        .timeline-dot {
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 3px solid var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .timeline-dot.detected {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .timeline-period {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .timeline-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0.25rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .timeline-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }
        
        .timeline-markers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .timeline-marker-tag {
            background: var(--bg-secondary);
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .timeline-marker-tag.detected {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        /* ========================================
           Ancient Matches Section (YourTrueAncestry-style)
           ======================================== */
        .ancient-matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }
        
        .ancient-card {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-card));
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ancient-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .ancient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8B4513, #CD853F, #D2691E);
        }
        
        .ancient-card.mesolithic::before { background: linear-gradient(90deg, #2E86AB, #36A2C9); }
        .ancient-card.neolithic::before { background: linear-gradient(90deg, #F18F01, #FFB347); }
        .ancient-card.bronze-age::before { background: linear-gradient(90deg, #CD7F32, #DAA520); }
        .ancient-card.iron-age::before { background: linear-gradient(90deg, #4A7C59, #6B8E23); }
        .ancient-card.roman::before { background: linear-gradient(90deg, #DC143C, #FF4500); }
        .ancient-card.medieval::before { background: linear-gradient(90deg, #6247AA, #9370DB); }
        
        .match-rank {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--accent-primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }
        
        .match-rank.gold { background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; }
        .match-rank.silver { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); color: #333; }
        .match-rank.bronze { background: linear-gradient(135deg, #CD7F32, #B87333); color: #fff; }
        
        .ancient-card h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            padding-right: 40px;
            color: var(--text-primary);
        }
        
        .match-distance {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.75rem 0;
        }
        
        .similarity-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-primary);
            min-width: 70px;
        }
        
        .similarity-value::after {
            content: '%';
            font-size: 0.875rem;
            opacity: 0.7;
        }
        
        .distance-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .distance-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }
        
        .match-period {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .period-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: var(--bg-primary);
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .match-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0.75rem 0;
        }
        
        .match-location {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.35rem;
            margin-bottom: 0.5rem;
        }
        
        .shared-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }
        
        .trait {
            font-size: 0.75rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            background: var(--bg-primary);
        }
        
        .trait.match {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .trait.match::before {
            content: 'âœ“ ';
        }
        
        /* Culture Affinity Bars */
        .culture-affinities {
            margin: 2rem 0;
        }
        
        .culture-bar-container {
            margin-bottom: 1rem;
        }
        
        .culture-bar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.35rem;
        }
        
        .culture-name {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .culture-period {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        .culture-affinity-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .culture-bar-track {
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        
        .culture-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.6s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 50px;
        }
        
        /* Visual Timeline */
        .visual-timeline {
            position: relative;
            margin: 2rem 0;
            padding: 1rem 0;
            overflow-x: auto;
        }
        
        .timeline-axis {
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        .timeline-track {
            height: 80px;
            background: linear-gradient(90deg, 
                #2E86AB 0%, #2E86AB 10%,
                #F18F01 10%, #F18F01 30%,
                #CD7F32 30%, #CD7F32 60%,
                #4A7C59 60%, #4A7C59 70%,
                #DC143C 70%, #DC143C 80%,
                #6247AA 80%, #6247AA 100%
            );
            border-radius: 8px;
            position: relative;
            margin: 0 1rem;
        }
        
        .timeline-marker {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            text-align: center;
        }
        
        .timeline-marker-dot {
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border: 2px solid white;
            border-radius: 50%;
            margin: 0 auto 4px;
            box-shadow: var(--shadow);
        }
        
        .timeline-marker-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            max-width: 60px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Famous Ancients Grid */
        .famous-ancients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .famous-ancient-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }
        
        .famous-ancient-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }
        
        .famous-ancient-info h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .famous-ancient-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .famous-ancient-similarity {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        /* Methodology Note */
        .methodology-note {
            background: linear-gradient(145deg, rgba(79, 70, 229, 0.08), rgba(129, 140, 248, 0.04));
            border: 1px solid rgba(79, 70, 229, 0.2);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .methodology-note h4 {
            color: var(--accent-primary);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .methodology-note p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .methodology-note ul {
            margin-top: 0.75rem;
            padding-left: 1.25rem;
        }
        
        .methodology-note li {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        /* Open Source Badge */
        .open-source-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
            color: var(--success);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        /* Ancient Section Header */
        .ancient-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .ancient-section-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }
        
        .why-no-percentages {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(129, 140, 248, 0.05));
            border: 1px solid var(--accent-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .why-no-percentages h4 {
            color: var(--accent-primary);
            margin-bottom: 0.75rem;
        }
        
        .why-no-percentages ul {
            margin: 0.5rem 0;
            padding-left: 1.25rem;
        }
        
        .why-no-percentages li {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        /* ========================================
           Ancient Matches Styles
           ======================================== */
        .open-source-badge {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            border: 1px solid var(--success);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: var(--success);
        }
        
        .open-source-badge span {
            font-size: 1.5rem;
        }
        
        .ancient-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .ancient-section-header h3 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
        }
        
        .export-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        .ancient-matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
        }
        
        .ancient-match-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.25rem;
            border-left: 4px solid var(--accent-primary);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ancient-match-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .ancient-match-rank {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .ancient-match-rank .rank-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
            line-height: 1;
        }
        
        .ancient-match-similarity {
            text-align: right;
        }
        
        .ancient-match-similarity .percent {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .ancient-match-similarity .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .ancient-match-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .ancient-match-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .ancient-match-culture {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: var(--bg-primary);
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }
        
        .ancient-match-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }
        
        .ancient-match-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-bottom: 0.75rem;
        }
        
        .trait-tag {
            background: rgba(79, 70, 229, 0.1);
            color: var(--accent-primary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
        }
        
        .trait-tag.match {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .ancient-match-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
        }
        
        .culture-affinities {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .culture-affinity-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .culture-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }
        
        .culture-info {
            flex: 1;
            min-width: 0;
        }
        
        .culture-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .culture-bar-container {
            flex: 2;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .culture-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 0.5rem;
        }
        
        .culture-bar-fill span {
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .visual-timeline {
            position: relative;
            padding: 1rem 0 1rem 60px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            margin-top: 1rem;
        }
        
        .timeline-axis {
            position: absolute;
            left: 50px;
            top: 1rem;
            bottom: 1rem;
            width: 3px;
            background: linear-gradient(to bottom, #f59e0b, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }
        
        .timeline-entry {
            position: relative;
            padding: 0.75rem 0 0.75rem 1.5rem;
            margin-left: 10px;
        }
        
        .timeline-entry::before {
            content: '';
            position: absolute;
            left: -13px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: 2px solid var(--bg-secondary);
        }
        
        .timeline-date {
            position: absolute;
            left: -55px;
            width: 45px;
            text-align: right;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .timeline-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timeline-name {
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .timeline-culture {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .timeline-similarity {
            font-weight: 600;
            color: var(--accent-primary);
        }
        
        .famous-ancients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .famous-ancient-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
        }
        
        .famous-ancient-emoji {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .famous-ancient-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .famous-ancient-period {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .famous-ancient-similarity {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .methodology-note {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.25rem;
            margin-top: 1.5rem;
        }
        
        .methodology-note h4 {
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }
        
        .methodology-note p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .methodology-note ul {
            margin: 0.5rem 0;
            padding-left: 0;
            list-style: none;
        }
        
        .methodology-note li {
            font-size: 0.85rem;
            margin-bottom: 0.35rem;
            padding-left: 0;
        }
        
        .haplogroup-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.25rem;
            text-align: center;
        }
        
        .haplogroup-type {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .haplogroup-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .haplogroup-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        /* ========================================
           Carrier Status
           ======================================== */
        .carrier-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .carrier-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .carrier-status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .carrier-status-icon.positive {
            background: rgba(245,158,11,0.2);
        }
        
        .carrier-status-icon.negative {
            background: rgba(16,185,129,0.2);
        }
        
        .carrier-info {
            flex: 1;
        }
        
        .carrier-info h4 {
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .carrier-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* ========================================
           Sleep Profile
           ======================================== */
        .sleep-profile {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .chronotype-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }
        
        .clock-display {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .chronotype-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .chronotype-value {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .sleep-recommendations {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.5rem;
        }
        
        .sleep-recommendations h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .sleep-time-grid {
            display: grid;
            gap: 0.75rem;
        }
        
        .sleep-time-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sleep-time-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .sleep-time-value {
            font-weight: 600;
            font-family: var(--font-mono);
        }
        
        /* ========================================
           UV/Skin Section
           ======================================== */
        .skin-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .skin-type-card {
            text-align: center;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }
        
        .skin-type-visual {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
        }
        
        .spf-recommendation {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.5rem;
        }
        
        .spf-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--warning);
            text-align: center;
        }
        
        .spf-label {
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        /* ========================================
           Search & Filter
           ======================================== */
        .search-bar {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .search-bar .input {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-pills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-pill {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-pill:hover, .filter-pill.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        /* ========================================
           Disclaimer
           ======================================== */
        .disclaimer {
            background: var(--bg-secondary);
            border-left: 4px solid var(--warning);
            padding: 1rem 1.5rem;
            margin-top: 2rem;
            border-radius: 0 var(--radius) var(--radius) 0;
        }
        
        .disclaimer h3 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .disclaimer p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }
        
        /* ========================================
           PMID Links
           ======================================== */
        .pmid-link {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--accent-primary);
            text-decoration: none;
            padding: 0.1rem 0.35rem;
            background: rgba(79,70,229,0.1);
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .pmid-link:hover {
            background: var(--accent-primary);
            color: white;
        }
        
        .pmid-list {
            display: inline-flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        
        /* ========================================
           Confidence Intervals
           ======================================== */
        .confidence-interval {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: inline-block;
            margin-left: 0.5rem;
        }
        
        .prs-range {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        /* ========================================
           Haplogroup Warning Banner
           ======================================== */
        .warning-banner {
            background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05));
            border: 2px solid var(--warning);
            border-radius: var(--radius);
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
        }
        
        .warning-banner h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 0.5rem;
        }
        
        .warning-banner p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .warning-banner ul {
            margin-top: 0.5rem;
            padding-left: 1.25rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .warning-banner li {
            margin-bottom: 0.25rem;
        }
        
        /* ========================================
           Methodology Section
           ======================================== */
        .methodology-section {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            margin-top: 1.5rem;
            overflow: hidden;
        }
        
        .methodology-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            cursor: pointer;
            user-select: none;
        }
        
        .methodology-header:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .methodology-header h4 {
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .methodology-content {
            padding: 0 1.25rem 1.25rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }
        
        .methodology-content.hidden {
            display: none;
        }
        
        .methodology-content ul {
            padding-left: 1.25rem;
            margin: 0.5rem 0;
        }
        
        .methodology-content li {
            margin-bottom: 0.35rem;
        }
        
        /* ========================================
           Loading & Error States
           ======================================== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-secondary);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-state {
            text-align: center;
            padding: 4rem 2rem;
        }
        
        .error-state h2 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        
        .error-state p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--accent-primary);
            background: rgba(79,70,229,0.05);
        }
        
        .drop-zone svg {
            margin-bottom: 1rem;
        }
        
        /* ========================================
           Footer
           ======================================== */
        footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .footer-content a {
            color: var(--accent-primary);
            text-decoration: none;
        }
        
        /* ========================================
           Print Styles
           ======================================== */
        @media print {
            header, nav, .btn, .search-bar, .theme-toggle {
                display: none !important;
            }
            
            .card.collapsed .card-body {
                display: block !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        /* ========================================
           Responsive
           ======================================== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav {
                top: auto;
                position: relative;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .gauge-container {
                padding: 0.5rem;
            }
            
            .gauge {
                width: 150px;
                height: 75px;
            }
        }
        
        /* Hidden utility */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" stroke="white" stroke-width="2"/>
                        <path d="M12 20C12 20 16 12 20 12C24 12 28 20 28 20C28 20 24 28 20 28C16 28 12 20 12 20Z" stroke="white" stroke-width="2"/>
                        <circle cx="20" cy="20" r="4" fill="white"/>
                    </svg>
                    <h1>Personal Genomics Dashboard</h1>
                </div>
                <div class="header-controls">
                    <button class="btn btn-secondary" onclick="toggleTheme()" title="Toggle dark mode">
                        <span id="theme-icon">ðŸŒ™</span>
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()" title="Export to PDF">
                        ðŸ“„ Export PDF
                    </button>
                    <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                        ðŸ“‚ Load Data
                    </button>
                    <input type="file" id="file-input" accept=".json" class="hidden" onchange="loadFile(event)">
                </div>
            </div>
        </div>
    </header>
    
    <nav id="main-nav" class="hidden">
        <div class="container">
            <div class="nav-links">
                <a href="#overview" class="nav-link active">Overview</a>
                <a href="#pharmacogenomics" class="nav-link">ðŸ’Š Pharmacogenomics</a>
                <a href="#health-risks" class="nav-link">ðŸ“Š Health Risks</a>
                <a href="#traits" class="nav-link">ðŸ§¬ Traits</a>
                <a href="#population-comparison" class="nav-link">ðŸŒ Population Comparison</a>
                <a href="#ancient-matches" class="nav-link">âš”ï¸ Ancient Matches</a>
                <a href="#ancient-dna" class="nav-link">ðŸ›ï¸ Ancient DNA</a>
                <a href="#carrier" class="nav-link">ðŸ§ª Carrier Status</a>
                <a href="#sleep" class="nav-link">ðŸ˜´ Sleep</a>
                <a href="#athletic" class="nav-link">ðŸƒ Athletic</a>
                <a href="#uv" class="nav-link">â˜€ï¸ UV/Skin</a>
                <a href="#dietary" class="nav-link">ðŸ¥— Dietary</a>
                <a href="#methodology" class="nav-link">ðŸ“‹ Methodology</a>
            </div>
        </div>
    </nav>
    
    <main class="container">
        <!-- Initial Load State -->
        <div id="initial-state">
            <div class="card">
                <div class="card-body">
                    <div class="drop-zone" id="drop-zone">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <h2 style="margin-bottom: 0.5rem;">Load Your Genetic Data</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Drag & drop <code>agent_summary.json</code> or <code>full_analysis.json</code> here
                        </p>
                        <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                            Browse Files
                        </button>
                        <p style="margin-top: 1.5rem; font-size: 0.8rem; color: var(--text-secondary);">
                            ðŸ”’ All analysis runs locally in your browser. No data is uploaded.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Content (hidden initially) -->
        <div id="dashboard-content" class="hidden">
            
            <!-- Overview Section -->
            <section id="overview">
                <div class="stats-grid" id="stats-grid"></div>
                
                <!-- Critical Alerts -->
                <div id="critical-alerts"></div>
                
                <!-- High Priority -->
                <div id="high-priority"></div>
            </section>
            
            <!-- Pharmacogenomics Section -->
            <section id="pharmacogenomics">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ’Š Pharmacogenomics</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="search-bar">
                            <input type="text" class="input" placeholder="Search drugs or genes..." id="pharma-search" oninput="filterTable('pharma-table', this.value)">
                        </div>
                        <div class="table-container">
                            <table id="pharma-table">
                                <thead>
                                    <tr>
                                        <th>Gene</th>
                                        <th>rsID</th>
                                        <th>Genotype</th>
                                        <th>Variant</th>
                                        <th>Impact</th>
                                    </tr>
                                </thead>
                                <tbody id="pharma-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Health Risks Section -->
            <section id="health-risks">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ“Š Polygenic Risk Scores</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="prs-grid" id="prs-grid"></div>
                    </div>
                </div>
            </section>
            
            <!-- Traits Section -->
            <section id="traits">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ§¬ Traits</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="search-bar">
                            <input type="text" class="input" placeholder="Search traits..." id="trait-search" oninput="filterTraits(this.value)">
                        </div>
                        <div class="trait-grid" id="trait-grid"></div>
                    </div>
                </div>
            </section>
            
            <!-- Population Comparison Section -->
            <section id="population-comparison">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸŒ 1000 Genomes Population Comparison</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="pop-comparison-container" id="pop-comparison"></div>
                    </div>
                </div>
            </section>
            
            <!-- Ancient DNA Section -->
            <section id="ancient-dna">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ›ï¸ Ancient DNA Matches</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="open-source-badge">
                            <span>ðŸ”“</span>
                            FREE & OPEN SOURCE â€” Better than paid services
                        </div>
                        
                        <!-- Top Ancient Matches -->
                        <div class="ancient-section-header">
                            <h3>ðŸŽ¯ Your Closest Ancient Matches</h3>
                            <button class="export-btn" onclick="exportAncientData()">
                                ðŸ“¥ Export Data
                            </button>
                        </div>
                        <div class="ancient-matches-grid" id="ancient-matches-grid">
                            <!-- Populated by JavaScript -->
                        </div>
                        
                        <!-- Culture Affinities -->
                        <div class="ancient-section-header">
                            <h3>ðŸº Culture Affinities</h3>
                        </div>
                        <div class="culture-affinities" id="culture-affinities">
                            <!-- Populated by JavaScript -->
                        </div>
                        
                        <!-- Visual Timeline -->
                        <div class="ancient-section-header">
                            <h3>ðŸ“… Timeline of Your Matches</h3>
                        </div>
                        <div class="visual-timeline" id="visual-timeline">
                            <!-- Populated by JavaScript -->
                        </div>
                        
                        <!-- Famous Ancients Comparison -->
                        <div class="ancient-section-header">
                            <h3>ðŸ‘‘ Famous Ancient Comparisons</h3>
                        </div>
                        <div class="famous-ancients-grid" id="famous-ancients-grid">
                            <!-- Populated by JavaScript -->
                        </div>
                        
                        <!-- Ancient Population Signals (existing) -->
                        <div class="ancient-section-header" style="margin-top: 2rem;">
                            <h3>ðŸ§¬ Ancient Population Signals & Haplogroups</h3>
                        </div>
                        <div class="ancestry-info" id="ancestry-info"></div>
                        
                        <!-- Methodology Note -->
                        <div class="methodology-note">
                            <h4>ðŸ“‹ How This Works (Full Transparency)</h4>
                            <p>
                                We compare your DNA directly to <strong>published ancient genomes</strong> using 
                                <strong>Identity-by-State (IBS)</strong> similarity â€” counting shared alleles at each SNP position.
                            </p>
                            <p style="margin-top: 0.75rem;">
                                <strong>Unlike proprietary services like YourTrueAncestry:</strong>
                            </p>
                            <ul>
                                <li>âœ… <strong>Full transparency</strong> â€” Our methodology is completely open</li>
                                <li>âœ… <strong>Citations for everything</strong> â€” Every ancient sample has a PMID</li>
                                <li>âœ… <strong>Downloadable data</strong> â€” Export raw comparisons anytime</li>
                                <li>âœ… <strong>Free forever</strong> â€” No paywall, no subscription</li>
                                <li>âœ… <strong>Open source</strong> â€” Code is fully auditable</li>
                            </ul>
                            <p style="margin-top: 0.75rem;">
                                <strong>Important notes:</strong> Similarity depends on available SNPs in both samples. 
                                Ancient DNA often has missing data due to degradation. High similarity does not mean direct descent â€” 
                                all Europeans share ancient ancestry patterns.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Carrier Status Section -->
            <section id="carrier">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ§ª Carrier Status</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="carrier-list" id="carrier-list"></div>
                    </div>
                </div>
            </section>
            
            <!-- Sleep Profile Section -->
            <section id="sleep">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ˜´ Sleep Profile</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="sleep-profile" id="sleep-profile"></div>
                    </div>
                </div>
            </section>
            
            <!-- Athletic Profile Section -->
            <section id="athletic">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸƒ Athletic Profile</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div id="athletic-profile"></div>
                    </div>
                </div>
            </section>
            
            <!-- UV/Skin Section -->
            <section id="uv">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>â˜€ï¸ UV Sensitivity & Skin</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="skin-info" id="skin-info"></div>
                    </div>
                </div>
            </section>
            
            <!-- Dietary Section -->
            <section id="dietary">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ¥— Dietary Interactions</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body">
                        <div class="food-matrix" id="food-matrix"></div>
                    </div>
                </div>
            </section>
            
            <!-- Methodology & Limitations Section -->
            <section id="methodology">
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this)">
                        <h2>ðŸ“‹ Methodology & Limitations</h2>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="card-body" id="methodology-content">
                        <div class="methodology-content">
                            <h4>ðŸ”¬ Analysis Methodology</h4>
                            <p>This analysis uses publicly available genetic research and GWAS data to interpret your genotype data.</p>
                            <ul>
                                <li>Pharmacogenomics: Based on PharmGKB and CPIC guidelines</li>
                                <li>Polygenic Risk Scores: Aggregated from published GWAS effect sizes</li>
                                <li>Ancestry: Likelihood-based estimation using ancestry informative markers</li>
                                <li>Haplogroups: Pattern matching against known phylogenetic markers</li>
                            </ul>
                            
                            <h4 style="margin-top: 1.5rem;">âš ï¸ Critical Limitations</h4>
                            <ul>
                                <li><strong>Consumer arrays capture ~0.1% of the genome</strong> â€” rare and structural variants are missed</li>
                                <li><strong>Most conditions are not purely genetic</strong> â€” lifestyle and environment matter enormously</li>
                                <li><strong>Ancestry estimates are continental-level only</strong> â€” sub-regional claims (Irish vs Scottish) are unreliable</li>
                                <li><strong>Haplogroup calls are LOW CONFIDENCE</strong> â€” use dedicated Y-DNA/mtDNA testing for accuracy</li>
                                <li><strong>Polygenic scores have wide confidence intervals</strong> â€” interpret ranges, not point estimates</li>
                                <li><strong>Reference populations are biased</strong> â€” most research uses European-ancestry samples</li>
                            </ul>
                            
                            <h4 style="margin-top: 1.5rem;">ðŸ“š Key References</h4>
                            <p>Literature citations (PMIDs) are provided where available. Click any PMID to view on PubMed.</p>
                            <div id="methodology-pmids"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Disclaimer -->
            <div class="disclaimer">
                <h3>âš ï¸ Important Disclaimers</h3>
                <p>
                    This analysis is for <strong>informational purposes only</strong> and is NOT medical advice. 
                    Genetic risk does not equal destiny â€” lifestyle, environment, and other factors play a major role.
                    Consumer DNA arrays capture ~0.1% of your genome and may miss important variants.
                    <strong>Always consult healthcare providers before making medical decisions.</strong>
                </p>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <p>Personal Genomics Dashboard v4.4.0 | Analysis runs locally, your data stays private</p>
                <p style="margin-top: 0.5rem;">
                    <a href="https://github.com/elata-bio/personal-genomics" target="_blank">GitHub</a> Â· 
                    Generated by <a href="https://openclaw.ai">OpenClaw</a>
                </p>
            </div>
        </div>
    </footer>
    
    <script>
        // ========================================
        // Global State
        // ========================================
        let data = null;
        let allTraits = [];
        
        // ========================================
        // Theme Toggle
        // ========================================
        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? '' : 'dark');
            document.getElementById('theme-icon').textContent = isDark ? 'ðŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }
        
        // Initialize theme
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.setAttribute('data-theme', 'dark');
            document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        }
        
        // ========================================
        // File Loading
        // ========================================
        const dropZone = document.getElementById('drop-zone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) processFile(file);
        });
        
        function loadFile(event) {
            const file = event.target.files[0];
            if (file) processFile(file);
        }
        
        function processFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    data = JSON.parse(e.target.result);
                    renderDashboard();
                } catch (err) {
                    alert('Error parsing JSON file: ' + err.message);
                    console.error(err);
                }
            };
            reader.onerror = () => alert('Error reading file');
            reader.readAsText(file);
        }
        
        // ========================================
        // Dashboard Rendering
        // ========================================
        function renderDashboard() {
            document.getElementById('initial-state').classList.add('hidden');
            document.getElementById('dashboard-content').classList.remove('hidden');
            document.getElementById('main-nav').classList.remove('hidden');
            
            renderStats();
            renderAlerts();
            renderPharma();
            renderPRS();
            renderTraits();
            renderPopulationComparison();
            renderAncientMatches();
            renderAncestry();
            renderCarrier();
            renderSleep();
            renderAthletic();
            renderSkin();
            renderDietary();
        }
        
        // ========================================
        // Stats Section
        // ========================================
        function renderStats() {
            const grid = document.getElementById('stats-grid');
            const snps = data.snps_analyzed || data.total_snps || 0;
            const format = data.format_detected || data.format || 'Unknown';
            const criticalCount = (data.critical_alerts || []).length;
            const highCount = (data.high_priority || []).length;
            
            grid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${snps.toLocaleString()}</div>
                    <div class="stat-label">SNPs Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${format}</div>
                    <div class="stat-label">File Format</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${criticalCount > 0 ? 'var(--danger)' : 'var(--success)'}">${criticalCount}</div>
                    <div class="stat-label">Critical Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${highCount > 0 ? 'var(--warning)' : 'var(--success)'}">${highCount}</div>
                    <div class="stat-label">High Priority</div>
                </div>
            `;
        }
        
        // ========================================
        // Alerts Section
        // ========================================
        function renderAlerts() {
            const criticalContainer = document.getElementById('critical-alerts');
            const highContainer = document.getElementById('high-priority');
            
            const criticals = data.critical_alerts || [];
            const highs = data.high_priority || [];
            
            if (criticals.length > 0) {
                criticalContainer.innerHTML = `
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <h2>ðŸš¨ Critical Alerts</h2>
                            <span class="badge badge-danger">${criticals.length}</span>
                        </div>
                        <div class="card-body">
                            ${criticals.map(alert => `
                                <div class="alert alert-critical">
                                    <div class="alert-icon">âš ï¸</div>
                                    <div class="alert-content">
                                        <h3>${alert.gene || 'Unknown'} (${alert.rsid || 'N/A'})</h3>
                                        <p>Genotype: <code class="mono">${alert.genotype || 'N/A'}</code></p>
                                        ${alert.recommendations ? `
                                            <ul class="alert-recommendations">
                                                ${alert.recommendations.map(r => `<li>${r}</li>`).join('')}
                                            </ul>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (highs.length > 0) {
                highContainer.innerHTML = `
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <h2>âš¡ High Priority Findings</h2>
                            <span class="badge badge-warning">${highs.length}</span>
                        </div>
                        <div class="card-body">
                            ${highs.slice(0, 10).map(item => `
                                <div class="alert alert-high">
                                    <div class="alert-icon">ðŸ“‹</div>
                                    <div class="alert-content">
                                        <h3>${item.gene || 'Unknown'} (${item.rsid || 'N/A'})</h3>
                                        <p>Genotype: <code class="mono">${item.genotype || 'N/A'}</code></p>
                                        ${item.recommendations ? `
                                            <ul class="alert-recommendations">
                                                ${item.recommendations.slice(0, 3).map(r => `<li>${r}</li>`).join('')}
                                            </ul>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                            ${highs.length > 10 ? `<p style="color: var(--text-secondary); text-align: center;">+ ${highs.length - 10} more findings</p>` : ''}
                        </div>
                    </div>
                `;
            }
        }
        
        // ========================================
        // Pharmacogenomics Section
        // ========================================
        function renderPharma() {
            const tbody = document.getElementById('pharma-tbody');
            
            // Get pharma data from multiple possible sources
            let pharmaData = [];
            
            if (data.pharmacogenomics_alerts) {
                pharmaData = data.pharmacogenomics_alerts;
            } else if (data.pharmacogenomics?.findings) {
                pharmaData = data.pharmacogenomics.findings;
            }
            
            if (pharmaData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No pharmacogenomics data available</td></tr>';
                return;
            }
            
            tbody.innerHTML = pharmaData.map(item => {
                const isRisk = item.is_risk || item.risk_copies > 0 || item.priority === 'high' || item.priority === 'critical';
                return `
                    <tr data-searchable="${(item.gene || '').toLowerCase()} ${(item.rsid || '').toLowerCase()} ${(item.variant || '').toLowerCase()}">
                        <td><strong>${item.gene || 'Unknown'}</strong></td>
                        <td class="mono">${item.rsid || 'N/A'}</td>
                        <td class="mono">${item.genotype || 'N/A'}</td>
                        <td>${item.variant || '-'}</td>
                        <td><span class="badge ${isRisk ? 'badge-warning' : 'badge-neutral'}">${isRisk ? 'Actionable' : 'Normal'}</span></td>
                    </tr>
                `;
            }).join('');
        }
        
        // ========================================
        // PRS Section (with confidence intervals)
        // ========================================
        function renderPRS() {
            const grid = document.getElementById('prs-grid');
            const prs = data.polygenic_risk_scores || data.prs || {};
            
            if (Object.keys(prs).length === 0 || prs.error) {
                grid.innerHTML = '<p style="color: var(--text-secondary);">No polygenic risk scores available</p>';
                return;
            }
            
            // Add methodology note at top
            let html = `
                <div class="warning-banner" style="grid-column: 1 / -1; margin-bottom: 1rem;">
                    <h4>âš ï¸ Interpret with Caution</h4>
                    <p>
                        Polygenic scores are <strong>probabilistic estimates with wide confidence intervals</strong>. 
                        They do NOT predict whether you will develop a condition. Most conditions are 50-80% non-genetic.
                        Percentile RANGES are shown because point estimates give false precision.
                    </p>
                </div>
            `;
            
            html += Object.entries(prs).map(([condition, scores]) => {
                const percentile = scores.percentile_estimate || 50;
                const confidence = scores.confidence || 'low';
                const coverage = Math.round((scores.coverage || 0) * 100);
                const snpsFound = scores.snps_found || 0;
                const snpsTotal = scores.snps_total || 0;
                
                // Calculate confidence interval based on coverage
                // Lower coverage = wider interval
                let intervalWidth = confidence === 'low' ? 20 : confidence === 'moderate' ? 15 : 10;
                if (coverage < 50) intervalWidth += 10;
                
                const lowerBound = Math.max(1, percentile - intervalWidth);
                const upperBound = Math.min(99, percentile + intervalWidth);
                
                // Color based on upper bound (conservative)
                let color = 'var(--success)';
                let riskLabel = 'likely average or below';
                if (lowerBound > 60) {
                    color = 'var(--danger)';
                    riskLabel = 'possibly elevated';
                } else if (upperBound > 70) {
                    color = 'var(--warning)';
                    riskLabel = 'uncertain - could be average or elevated';
                }
                
                return `
                    <div class="prs-card">
                        <div class="prs-header">
                            <span class="prs-name">${formatConditionName(condition)}</span>
                            <span class="prs-percentile" style="color: ${color}">${lowerBound}-${upperBound}%</span>
                        </div>
                        <div class="prs-bar-container">
                            <div class="prs-bar" style="width: ${upperBound}%; background: ${color}; opacity: 0.3;"></div>
                            <div class="prs-bar" style="width: ${lowerBound}%; background: ${color}; position: absolute; top: 0;"></div>
                            <div class="prs-marker" style="left: ${percentile}%"></div>
                        </div>
                        <div class="prs-scale">
                            <span>Low Risk</span>
                            <span>Average</span>
                            <span>High Risk</span>
                        </div>
                        <div class="prs-confidence">
                            ${snpsFound}/${snpsTotal} SNPs (${coverage}%) Â· Confidence: ${confidence}
                        </div>
                        <div class="prs-range" style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">
                            Interpretation: ${riskLabel}
                        </div>
                    </div>
                `;
            }).join('');
            
            grid.innerHTML = html;
        }
        
        // ========================================
        // Traits Section
        // ========================================
        function renderTraits() {
            const grid = document.getElementById('trait-grid');
            
            // Collect traits from multiple sources
            allTraits = data.notable_traits || [];
            
            if (data.traits?.findings) {
                allTraits = [...allTraits, ...data.traits.findings.map(f => ({
                    trait: f.trait || f.name,
                    gene: f.gene,
                    genotype: f.genotype,
                    interpretation: f.effect || f.interpretation
                }))];
            }
            
            // Remove duplicates
            const seen = new Set();
            allTraits = allTraits.filter(t => {
                const key = `${t.trait}-${t.gene}`;
                if (seen.has(key)) return false;
                seen.add(key);
                return true;
            });
            
            renderTraitGrid(allTraits);
        }
        
        function renderTraitGrid(traits) {
            const grid = document.getElementById('trait-grid');
            
            if (traits.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-secondary);">No trait data available</p>';
                return;
            }
            
            const icons = {
                'caffeine': 'â˜•', 'coffee': 'â˜•', 'sleep': 'ðŸ˜´', 'alcohol': 'ðŸ·',
                'lactose': 'ðŸ¥›', 'bitter': 'ðŸ¥¬', 'sweet': 'ðŸ¬', 'muscle': 'ðŸ’ª',
                'eye': 'ðŸ‘ï¸', 'hair': 'ðŸ’‡', 'skin': 'ðŸ§´', 'earwax': 'ðŸ‘‚',
                'cilantro': 'ðŸŒ¿', 'asparagus': 'ðŸ¥¦', 'smell': 'ðŸ‘ƒ'
            };
            
            grid.innerHTML = traits.slice(0, 24).map(trait => {
                const name = (trait.trait || 'Unknown').toLowerCase();
                let icon = 'ðŸ§¬';
                for (const [key, emoji] of Object.entries(icons)) {
                    if (name.includes(key)) { icon = emoji; break; }
                }
                
                let interpretation = trait.interpretation || '';
                if (typeof interpretation === 'object') {
                    interpretation = interpretation[trait.genotype] || JSON.stringify(interpretation);
                }
                
                return `
                    <div class="trait-card" data-trait="${name}">
                        <div class="trait-icon">${icon}</div>
                        <div class="trait-content">
                            <h4>${trait.trait || 'Unknown Trait'}</h4>
                            <p>${String(interpretation).substring(0, 80)}${interpretation.length > 80 ? '...' : ''}</p>
                            <span class="gene">${trait.gene || ''} Â· ${trait.genotype || ''}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterTraits(query) {
            const filtered = query 
                ? allTraits.filter(t => 
                    (t.trait || '').toLowerCase().includes(query.toLowerCase()) ||
                    (t.gene || '').toLowerCase().includes(query.toLowerCase())
                )
                : allTraits;
            renderTraitGrid(filtered);
        }
        
        // ========================================
        // Population Comparison Section
        // ========================================
        function renderPopulationComparison() {
            const container = document.getElementById('pop-comparison');
            const popData = data.population_comparison || {};
            
            let html = '';
            
            // Why No Percentages explainer
            html += `
                <div class="why-no-percentages">
                    <h4>ðŸ¤” Why We Show Comparisons, Not Percentages</h4>
                    <p>
                        Commercial DNA services give you numbers like "52% British, 23% German" â€” but these are 
                        <strong>model-dependent estimates</strong> that change when algorithms change.
                    </p>
                    <ul>
                        <li>Different companies give different percentages for the same DNA</li>
                        <li>Modern political boundaries don't match genetic reality</li>
                        <li>Sub-regional claims (Irish vs Scottish) are scientifically unreliable</li>
                    </ul>
                    <p style="margin-top: 0.75rem;">
                        Instead, we show you the <strong>raw data</strong>: how your genotypes compare to 
                        reference populations from the 1000 Genomes Project. You can see exactly what we know.
                    </p>
                </div>
            `;
            
            // Tabs
            html += `
                <div class="pop-tabs">
                    <button class="pop-tab active" onclick="showPopTab('ranking')">ðŸ† Most Similar Populations</button>
                    <button class="pop-tab" onclick="showPopTab('markers')">ðŸ§¬ By Marker</button>
                    <button class="pop-tab" onclick="showPopTab('superpops')">ðŸŒ Continental Summary</button>
                </div>
            `;
            
            // Tab content - Ranking
            const similarPops = popData.most_similar_populations || [];
            html += `<div id="pop-tab-ranking" class="pop-tab-content active">`;
            
            if (similarPops.length > 0) {
                html += `<div class="similarity-ranking">`;
                similarPops.slice(0, 10).forEach((pop, idx) => {
                    const superpopColors = {
                        'EUR': '#4f46e5', 'AFR': '#059669', 'EAS': '#dc2626', 
                        'SAS': '#d97706', 'AMR': '#7c3aed'
                    };
                    const color = superpopColors[pop.superpopulation] || 'var(--accent-primary)';
                    
                    html += `
                        <div class="similarity-card">
                            <div class="similarity-rank" style="color: ${color};">#${idx + 1}</div>
                            <div class="similarity-info">
                                <div class="similarity-name">${pop.flag || ''} ${pop.population_name}</div>
                                <div class="similarity-superpop">${pop.superpopulation || ''}</div>
                            </div>
                            <div class="similarity-score">${(pop.similarity_score || 0).toFixed(1)}%</div>
                        </div>
                    `;
                });
                html += `</div>`;
                html += `
                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem;">
                        Similarity score = average frequency of your genotypes in that population. 
                        Higher = your alleles are more common there.
                    </p>
                `;
            } else {
                html += `<p style="color: var(--text-secondary);">No population comparison data available.</p>`;
            }
            html += `</div>`;
            
            // Tab content - By Marker
            const markerDetails = popData.marker_details || [];
            html += `<div id="pop-tab-markers" class="pop-tab-content">`;
            
            if (markerDetails.length > 0) {
                html += `<input type="text" class="input" placeholder="Search markers..." 
                    style="margin-bottom: 1rem; max-width: 100%;"
                    onkeyup="filterMarkerDetails(this.value)">`;
                html += `<div id="marker-details-container">`;
                
                markerDetails.slice(0, 15).forEach(marker => {
                    const pops = marker.populations_by_frequency || [];
                    html += `
                        <div class="marker-detail-card" data-gene="${(marker.gene || '').toLowerCase()}" 
                             data-rsid="${(marker.rsid || '').toLowerCase()}" 
                             data-trait="${(marker.trait || '').toLowerCase()}">
                            <div class="marker-detail-header">
                                <div>
                                    <div class="marker-rsid">${marker.rsid}</div>
                                    ${marker.gene ? `<div class="marker-gene">${marker.gene}</div>` : ''}
                                    ${marker.trait ? `<div class="marker-trait">${marker.trait}</div>` : ''}
                                </div>
                                <div class="marker-genotype-badge">${marker.your_genotype}</div>
                            </div>
                            <div style="margin-top: 0.75rem;">
                    `;
                    
                    pops.slice(0, 8).forEach(pop => {
                        const superpopLower = (pop.superpop || 'eur').toLowerCase();
                        html += `
                            <div class="pop-bar-container">
                                <div class="pop-bar-label">
                                    <span>${pop.flag || ''} ${pop.name}</span>
                                    <span>${pop.frequency}%</span>
                                </div>
                                <div class="pop-bar-track">
                                    <div class="pop-bar-fill ${superpopLower}" style="width: ${pop.frequency}%;"></div>
                                </div>
                            </div>
                        `;
                    });
                    
                    if (marker.interpretation) {
                        html += `
                            <p style="font-size: 0.8rem; color: var(--accent-primary); margin-top: 0.75rem;">
                                â†’ ${marker.interpretation}
                            </p>
                        `;
                    }
                    
                    html += `</div></div>`;
                });
                
                if (markerDetails.length > 15) {
                    html += `<p style="color: var(--text-secondary); font-size: 0.8rem;">
                        ... and ${markerDetails.length - 15} more markers
                    </p>`;
                }
                html += `</div>`;
            } else {
                html += `<p style="color: var(--text-secondary);">No marker details available.</p>`;
            }
            html += `</div>`;
            
            // Tab content - Continental Summary
            const superpopSummary = popData.superpopulation_summary || {};
            html += `<div id="pop-tab-superpops" class="pop-tab-content">`;
            
            const superpopOrder = ['EUR', 'AFR', 'EAS', 'SAS', 'AMR'];
            const superpopNames = {
                'EUR': 'European', 'AFR': 'African', 'EAS': 'East Asian',
                'SAS': 'South Asian', 'AMR': 'Americas'
            };
            const superpopColors = {
                'EUR': '#4f46e5', 'AFR': '#059669', 'EAS': '#dc2626',
                'SAS': '#d97706', 'AMR': '#7c3aed'
            };
            
            superpopOrder.forEach(sp => {
                const spData = superpopSummary[sp] || {};
                const avgFreq = spData.average_frequency || 0;
                const color = superpopColors[sp];
                
                html += `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600;">${superpopNames[sp] || sp}</span>
                            <span style="font-weight: 700; color: ${color};">${avgFreq.toFixed(1)}%</span>
                        </div>
                        <div class="pop-bar-track" style="height: 24px;">
                            <div class="pop-bar-fill ${sp.toLowerCase()}" style="width: ${avgFreq}%;"></div>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                            Average frequency of your genotypes in ${superpopNames[sp] || sp} populations
                        </p>
                    </div>
                `;
            });
            
            html += `
                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem;">
                    <strong>Note:</strong> These are NOT ancestry percentages. They show how common your 
                    specific genotypes are in each continental population group.
                </p>
            `;
            html += `</div>`;
            
            // Methodology link
            html += `
                <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">
                        ðŸ“Š Data source: <a href="https://pubmed.ncbi.nlm.nih.gov/26432245/" target="_blank">
                        1000 Genomes Project Phase 3</a> (2,504 samples from 26 populations)
                    </p>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Tab switching for population comparison
        function showPopTab(tabName) {
            document.querySelectorAll('.pop-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.pop-tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('pop-tab-' + tabName).classList.add('active');
        }
        
        // Filter marker details in population comparison
        function filterMarkerDetails(query) {
            const container = document.getElementById('marker-details-container');
            if (!container) return;
            
            const cards = container.querySelectorAll('.marker-detail-card');
            const q = query.toLowerCase();
            
            cards.forEach(card => {
                const gene = card.dataset.gene || '';
                const rsid = card.dataset.rsid || '';
                const trait = card.dataset.trait || '';
                
                if (gene.includes(q) || rsid.includes(q) || trait.includes(q)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // ========================================
        // Ancient Matches Section (YourTrueAncestry Alternative)
        // ========================================
        function renderAncientMatches() {
            const ancientMatches = data.ancient_matches || {};
            // Support both old and new data formats
            const matches = ancientMatches.top_matches || ancientMatches.matches || [];
            const cultureAffinities = ancientMatches.culture_affinities || [];
            const timeline = ancientMatches.timeline || [];
            
            // Render top matches grid
            renderMatchesGrid(matches.slice(0, 12));
            
            // Render culture affinities
            renderCultureAffinities(cultureAffinities.slice(0, 10));
            
            // Render visual timeline
            renderVisualTimeline(timeline);
            
            // Render famous ancients
            renderFamousAncients(matches);
        }
        
        function renderMatchesGrid(matches) {
            const container = document.getElementById('ancient-matches-grid');
            if (!container || matches.length === 0) {
                if (container) {
                    container.innerHTML = '<p style="color: var(--text-secondary); grid-column: 1/-1;">No ancient matches data available. Run ancient DNA analysis to see your matches.</p>';
                }
                return;
            }
            
            const cultureColors = {
                'WHG': '#3b82f6', 'EHG': '#06b6d4', 'ANF': '#10b981', 'EEF': '#22c55e',
                'LBK': '#84cc16', 'Yamnaya': '#f59e0b', 'Corded_Ware': '#eab308',
                'Bell_Beaker': '#f97316', 'Celtic_IA': '#14b8a6', 'Roman': '#dc2626',
                'Anglo_Saxon': '#8b5cf6', 'Viking': '#6366f1', 'Medieval': '#a855f7'
            };
            
            let html = '';
            matches.forEach((match, i) => {
                const rank = i + 1;
                const similarity = match.similarity_percent || match.similarity || 0;
                const borderColor = cultureColors[match.culture] || 'var(--accent-primary)';
                const age = match.age_calBCE || match.age_bp || 0;
                const ageDisplay = age < 0 ? `${Math.abs(age)} CE` : `${age} BCE`;
                
                // Extract matched traits
                const traitMatches = (match.trait_comparison || []).filter(t => t.match);
                
                html += `
                    <div class="ancient-match-card" style="border-left-color: ${borderColor};">
                        <div class="ancient-match-rank">
                            <div class="rank-number">#${rank}</div>
                            <div class="ancient-match-similarity">
                                <div class="percent" style="color: ${borderColor};">${similarity.toFixed(1)}%</div>
                                <div class="label">similarity</div>
                            </div>
                        </div>
                        
                        <div class="ancient-match-name">${escapeHtml(match.name)}</div>
                        <div class="ancient-match-meta">${escapeHtml(match.period || '')} Â· ${ageDisplay}</div>
                        
                        <div class="ancient-match-culture" style="color: ${borderColor};">
                            ${escapeHtml(match.culture_name || match.culture || '')}
                        </div>
                        
                        <div class="ancient-match-description">
                            ${escapeHtml((match.description || '').substring(0, 120))}${(match.description || '').length > 120 ? '...' : ''}
                        </div>
                        
                        ${traitMatches.length > 0 ? `
                            <div class="ancient-match-traits">
                                ${traitMatches.slice(0, 3).map(t => `<span class="trait-tag match">âœ“ ${escapeHtml(t.trait)}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        ${(match.physical_traits || []).length > 0 ? `
                            <div class="ancient-match-traits">
                                ${match.physical_traits.slice(0, 3).map(t => `<span class="trait-tag">${escapeHtml(t)}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="ancient-match-footer">
                            <span>ðŸ“ ${escapeHtml(match.site || 'Unknown')}</span>
                            <span>${match.shared_snps || 0} SNPs</span>
                            ${match.pmid ? `<a href="https://pubmed.ncbi.nlm.nih.gov/${match.pmid}/" target="_blank" rel="noopener" class="pmid-link">PMID</a>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderCultureAffinities(affinities) {
            const container = document.getElementById('culture-affinities');
            if (!container || affinities.length === 0) {
                if (container) container.innerHTML = '';
                return;
            }
            
            const cultureColors = {
                'WHG': '#3b82f6', 'EHG': '#06b6d4', 'ANF': '#10b981', 'EEF': '#22c55e',
                'LBK': '#84cc16', 'Yamnaya': '#f59e0b', 'Corded_Ware': '#eab308',
                'Bell_Beaker': '#f97316', 'Celtic_IA': '#14b8a6', 'Roman': '#dc2626',
                'Anglo_Saxon': '#8b5cf6', 'Viking': '#6366f1', 'Medieval': '#a855f7',
                'Steppe_early': '#ca8a04', 'Afanasievo': '#ea580c', 'Sintashta': '#b45309'
            };
            
            let html = '';
            affinities.forEach(aff => {
                const color = aff.color || cultureColors[aff.culture_id] || 'var(--accent-primary)';
                const icon = aff.icon || 'ðŸ›ï¸';
                const affinity = aff.affinity_percent || aff.affinity || 0;
                
                html += `
                    <div class="culture-affinity-row">
                        <div class="culture-icon">${icon}</div>
                        <div class="culture-info">
                            <div class="culture-name">${escapeHtml(aff.name || aff.culture_id || '')}</div>
                        </div>
                        <div class="culture-bar-container">
                            <div class="culture-bar-fill" style="width: ${affinity}%; background: ${color};">
                                <span>${affinity.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderVisualTimeline(timeline) {
            const container = document.getElementById('visual-timeline');
            if (!container || timeline.length === 0) {
                if (container) container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 1rem;">Timeline will appear after analysis.</p>';
                return;
            }
            
            // Sort timeline by year (oldest first)
            const sorted = [...timeline].sort((a, b) => b.year - a.year);
            
            let html = '<div class="timeline-axis"></div>';
            
            sorted.slice(0, 8).forEach((item, i) => {
                const yearDisplay = item.year_display || (item.year < 0 ? `${Math.abs(item.year)} BCE` : `${item.year} CE`);
                const similarity = item.similarity || 0;
                
                html += `
                    <div class="timeline-entry">
                        <div class="timeline-date">${yearDisplay}</div>
                        <div class="timeline-content">
                            <div>
                                <div class="timeline-name">${escapeHtml(item.name || '')}</div>
                                <div class="timeline-culture">${escapeHtml(item.culture || '')}</div>
                            </div>
                            <div class="timeline-similarity">${similarity.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderFamousAncients(matches) {
            const container = document.getElementById('famous-ancients-grid');
            if (!container) return;
            
            // Famous individuals to highlight
            const famous = [
                { id: 'cheddar_man', icon: 'ðŸ’€', label: "Britain's oldest DNA" },
                { id: 'otzi', icon: 'ðŸ§Š', label: "The Iceman" },
                { id: 'bell_beaker_britain', icon: 'ðŸ””', label: "Stonehenge builder" },
                { id: 'viking_denmark', icon: 'âš”ï¸', label: "Viking warrior" },
                { id: 'loschbour', icon: 'ðŸ•ï¸', label: "Hunter-gatherer" },
                { id: 'yamnaya_samara', icon: 'ðŸ´', label: "Steppe pastoralist" }
            ];
            
            let html = '';
            famous.forEach(f => {
                const match = matches.find(m => m.id === f.id);
                if (match) {
                    const similarity = match.similarity_percent || match.similarity || 0;
                    const age = match.age_calBCE || 0;
                    const ageDisplay = age < 0 ? `${Math.abs(age)} CE` : `${age} BCE`;
                    
                    html += `
                        <div class="famous-ancient-card">
                            <div class="famous-ancient-emoji">${f.icon}</div>
                            <div class="famous-ancient-name">${escapeHtml(match.name)}</div>
                            <div class="famous-ancient-period">${f.label}<br>${ageDisplay}</div>
                            <div class="famous-ancient-similarity">${similarity.toFixed(1)}%</div>
                        </div>
                    `;
                }
            });
            
            if (!html) {
                html = '<p style="color: var(--text-secondary); grid-column: 1/-1;">Famous ancient comparisons will appear after analysis.</p>';
            }
            
            container.innerHTML = html;
        }
        
        function exportAncientData() {
            const ancientMatches = data.ancient_matches || {};
            const exportData = {
                export_date: new Date().toISOString(),
                methodology: ancientMatches.methodology || {},
                matches: ancientMatches.matches || [],
                culture_affinities: ancientMatches.culture_affinities || []
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ancient_dna_matches.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ========================================
        // Ancestry Section - Ancient Ancestral Signals
        // ========================================
        function renderAncestry() {
            const container = document.getElementById('ancestry-info');
            const haplogroups = data.haplogroups || {};
            const ancestry = data.ancestry || {};
            const signals = ancestry.signals?.populations || {};
            
            let html = '';
            
            // Educational intro about ancient ancestry
            html += `
                <div class="warning-banner" style="grid-column: 1 / -1; border-color: var(--info);">
                    <h4 style="color: var(--info);">ðŸ›ï¸ Why Ancient Signals Instead of Modern Ethnicity?</h4>
                    <p>
                        Modern ethnicity percentages (e.g., "32% Irish") are <strong>scientifically unreliable</strong> 
                        from consumer DNA arrays. Instead, we detect signals from <strong>well-characterized ancient populations</strong> 
                        based on ancient DNA research.
                    </p>
                    <p style="margin-top: 0.5rem;">
                        All modern Europeans are mixtures of: Mesolithic Hunter-Gatherers, Neolithic Farmers, 
                        and Bronze Age Steppe Pastoralists â€” plus ~1-4% archaic human (Neanderthal/Denisovan) ancestry.
                    </p>
                </div>
            `;
            
            // Ancient Population Signals
            const populationOrder = ['WHG', 'EEF', 'STEPPE', 'NEANDERTHAL', 'DENISOVAN'];
            const popIcons = {
                'WHG': 'ðŸ¹',
                'EEF': 'ðŸŒ¾',
                'STEPPE': 'ðŸ´',
                'NEANDERTHAL': 'ðŸ¦´',
                'DENISOVAN': 'ðŸ—»'
            };
            const popColors = {
                'WHG': '#3b82f6',
                'EEF': '#10b981',
                'STEPPE': '#f59e0b',
                'NEANDERTHAL': '#8b5cf6',
                'DENISOVAN': '#ec4899'
            };
            
            populationOrder.forEach(popKey => {
                const pop = signals[popKey] || {};
                const name = pop.name || popKey;
                const period = pop.time_period || 'Unknown period';
                const strength = pop.signal_strength || 'not detected';
                const markerCount = pop.marker_count || 0;
                const traits = pop.traits_contributed || [];
                const markers = pop.markers_detected || [];
                const pmids = pop.pmid || [];
                const icon = popIcons[popKey] || 'ðŸ§¬';
                const color = popColors[popKey] || 'var(--accent-primary)';
                
                // Signal strength indicator
                let strengthBars = '';
                let strengthLabel = '';
                if (strength === 'strong') {
                    strengthBars = 'â—â—â—';
                    strengthLabel = 'STRONG SIGNAL';
                } else if (strength === 'moderate') {
                    strengthBars = 'â—â—â—‹';
                    strengthLabel = 'MODERATE SIGNAL';
                } else if (strength === 'weak') {
                    strengthBars = 'â—â—‹â—‹';
                    strengthLabel = 'WEAK SIGNAL';
                } else {
                    strengthBars = 'â—‹â—‹â—‹';
                    strengthLabel = 'NOT DETECTED';
                }
                
                html += `
                    <div class="haplogroup-card" style="border-left: 4px solid ${color};">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <div class="haplogroup-type" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.5rem;">${icon}</span>
                                    ${name}
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                    ${period}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.25rem; letter-spacing: 2px; color: ${color};">${strengthBars}</div>
                                <div style="font-size: 0.7rem; font-weight: 600; color: ${strength === 'not detected' ? 'var(--text-secondary)' : color};">
                                    ${strengthLabel}
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">
                                    ${markerCount} marker${markerCount !== 1 ? 's' : ''} detected
                                </div>
                            </div>
                        </div>
                        
                        ${traits.length > 0 && markerCount > 0 ? `
                            <div style="margin-top: 1rem;">
                                <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    Traits Contributed by This Population:
                                </div>
                                <ul style="font-size: 0.8rem; color: var(--text-secondary); padding-left: 1.25rem; margin: 0;">
                                    ${traits.slice(0, 4).map(t => `<li>${t}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${markers.length > 0 ? `
                            <div style="margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--border-color);">
                                <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    Markers Detected:
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                    ${markers.slice(0, 4).map(m => `
                                        <div style="font-size: 0.75rem; background: var(--bg-primary); padding: 0.35rem 0.6rem; border-radius: 4px;">
                                            <strong>${m.gene || 'Unknown'}</strong>: ${m.trait || ''} 
                                            <span class="mono" style="color: var(--accent-primary);">${m.genotype || ''}</span>
                                        </div>
                                    `).join('')}
                                    ${markers.length > 4 ? `<span style="font-size: 0.75rem; color: var(--text-secondary);">+${markers.length - 4} more</span>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${pmids.length > 0 ? `
                            <div style="margin-top: 0.75rem;">
                                ${renderPMIDs(pmids)}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            // Haplogroup section (with disclaimer)
            if (haplogroups.mtDNA || haplogroups.Y_DNA) {
                html += `
                    <div style="grid-column: 1 / -1; margin-top: 1rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 1rem;">Maternal & Paternal Lineages (Haplogroups)</h3>
                    </div>
                `;
                
                html += `
                    <div class="warning-banner" style="grid-column: 1 / -1;">
                        <h4>âš ï¸ Haplogroup Limitation - LOW CONFIDENCE</h4>
                        <p>
                            Consumer DNA arrays <strong>cannot reliably determine haplogroups</strong>. 
                            These results are <strong>indicative only</strong> and may be incorrect.
                        </p>
                        <ul>
                            <li>Arrays test ~40 of thousands of haplogroup-defining markers</li>
                            <li>Missing markers can cause misclassification</li>
                            <li>Subclade resolution is NOT possible</li>
                        </ul>
                        <p style="margin-top: 0.75rem;">
                            <strong>For accurate haplogroups:</strong> FTDNA Big Y-700, FTDNA mtDNA Full Sequence, or YFull WGS
                        </p>
                    </div>
                `;
                
                // mtDNA haplogroup
                const mtdna = haplogroups.mtDNA || {};
                const mtConfidence = mtdna.confidence || 'low';
                html += `
                    <div class="haplogroup-card">
                        <div class="haplogroup-type">Maternal Lineage (mtDNA)</div>
                        <div class="haplogroup-value">${mtdna.haplogroup || 'Unknown'}*</div>
                        <div class="haplogroup-desc" style="color: var(--warning); font-size: 0.75rem;">
                            *${mtConfidence.includes('low') ? 'LOW CONFIDENCE' : mtConfidence}
                        </div>
                        <div class="haplogroup-desc">${mtdna.description || mtdna.history?.modern_distribution || ''}</div>
                        ${mtdna.pmid ? `<div style="margin-top: 0.5rem;">${renderPMIDs(mtdna.pmid)}</div>` : ''}
                    </div>
                `;
                
                // Y-DNA haplogroup
                if (haplogroups.Y_DNA && haplogroups.Y_DNA.haplogroup !== 'N/A (female)') {
                    const ydna = haplogroups.Y_DNA || {};
                    const yConfidence = ydna.confidence || 'low';
                    html += `
                        <div class="haplogroup-card">
                            <div class="haplogroup-type">Paternal Lineage (Y-DNA)</div>
                            <div class="haplogroup-value">${ydna.haplogroup || 'Unknown'}*</div>
                            <div class="haplogroup-desc" style="color: var(--warning); font-size: 0.75rem;">
                                *${yConfidence.includes('low') ? 'LOW CONFIDENCE' : yConfidence}
                            </div>
                            <div class="haplogroup-desc">${ydna.description || ydna.history?.modern_distribution || ''}</div>
                            ${ydna.pmid ? `<div style="margin-top: 0.5rem;">${renderPMIDs(ydna.pmid)}</div>` : ''}
                        </div>
                    `;
                } else if (haplogroups.Y_DNA?.haplogroup === 'N/A (female)') {
                    html += `
                        <div class="haplogroup-card">
                            <div class="haplogroup-type">Paternal Lineage (Y-DNA)</div>
                            <div class="haplogroup-value">N/A</div>
                            <div class="haplogroup-desc">Not applicable (no Y-chromosome detected - likely female)</div>
                        </div>
                    `;
                }
            }
            
            if (!html) {
                html = '<p style="color: var(--text-secondary);">No ancestry/haplogroup data available</p>';
            }
            
            container.innerHTML = html;
        }
        
        // Helper function to render PMIDs as clickable links
        function renderPMIDs(pmids) {
            if (!pmids) return '';
            const pmidList = Array.isArray(pmids) ? pmids : [pmids];
            if (pmidList.length === 0) return '';
            
            return `
                <span class="pmid-list">
                    ${pmidList.map(pmid => 
                        `<a href="https://pubmed.ncbi.nlm.nih.gov/${pmid}/" target="_blank" rel="noopener" class="pmid-link" title="View on PubMed">PMID:${pmid}</a>`
                    ).join('')}
                </span>
            `;
        }
        
        // ========================================
        // Carrier Status Section
        // ========================================
        function renderCarrier() {
            const container = document.getElementById('carrier-list');
            const carriers = data.carrier_status || [];
            
            if (carriers.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No carrier variants detected in tested markers</p>';
                return;
            }
            
            container.innerHTML = carriers.map(c => `
                <div class="carrier-item">
                    <div class="carrier-status-icon positive">ðŸ§¬</div>
                    <div class="carrier-info">
                        <h4>${c.gene || 'Unknown'} (${c.rsid || 'N/A'})</h4>
                        <p>Genotype: ${c.genotype || 'N/A'} Â· ${c.condition || c.action_type || 'Carrier status identified'}</p>
                        ${c.recommendations ? `<p style="margin-top: 0.5rem;">${c.recommendations[0] || ''}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        // ========================================
        // Sleep Profile Section
        // ========================================
        function renderSleep() {
            const container = document.getElementById('sleep-profile');
            const sleep = data.sleep_profile || data.lifestyle_recommendations || {};
            
            // Extract sleep-related data
            let chronotype = 'Intermediate';
            let caffeineMetabolism = 'Normal';
            let idealWake = '7:00 AM';
            let idealSleep = '11:00 PM';
            let coffeeCutoff = '2:00 PM';
            
            // Try to find sleep-related traits
            const sleepTraits = (data.notable_traits || []).filter(t => 
                (t.trait || '').toLowerCase().includes('sleep') ||
                (t.trait || '').toLowerCase().includes('caffeine') ||
                (t.trait || '').toLowerCase().includes('chronotype')
            );
            
            sleepTraits.forEach(t => {
                const trait = (t.trait || '').toLowerCase();
                if (trait.includes('chronotype') || trait.includes('morning') || trait.includes('evening')) {
                    chronotype = t.interpretation || chronotype;
                }
                if (trait.includes('caffeine')) {
                    caffeineMetabolism = t.interpretation || caffeineMetabolism;
                }
            });
            
            container.innerHTML = `
                <div class="chronotype-visual">
                    <div class="clock-display">ðŸŒ…</div>
                    <div class="chronotype-label">Your Chronotype</div>
                    <div class="chronotype-value">${typeof chronotype === 'string' ? chronotype.substring(0, 40) : 'Intermediate'}</div>
                </div>
                <div class="chronotype-visual">
                    <div class="clock-display">â˜•</div>
                    <div class="chronotype-label">Caffeine Metabolism</div>
                    <div class="chronotype-value">${typeof caffeineMetabolism === 'string' ? caffeineMetabolism.substring(0, 40) : 'Normal'}</div>
                </div>
                <div class="sleep-recommendations">
                    <h4>Personalized Timing</h4>
                    <div class="sleep-time-grid">
                        <div class="sleep-time-row">
                            <span class="sleep-time-label">Ideal Wake Time</span>
                            <span class="sleep-time-value">${idealWake}</span>
                        </div>
                        <div class="sleep-time-row">
                            <span class="sleep-time-label">Ideal Bedtime</span>
                            <span class="sleep-time-value">${idealSleep}</span>
                        </div>
                        <div class="sleep-time-row">
                            <span class="sleep-time-label">Caffeine Cutoff</span>
                            <span class="sleep-time-value">${coffeeCutoff}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========================================
        // Athletic Profile Section
        // ========================================
        function renderAthletic() {
            const container = document.getElementById('athletic-profile');
            
            // Look for fitness data
            let powerScore = 50;
            let enduranceScore = 50;
            let athleticType = 'Balanced';
            
            const fitnessFindings = data.fitness?.findings || [];
            
            fitnessFindings.forEach(f => {
                if (f.gene === 'ACTN3') {
                    if (f.genotype === 'CC') { powerScore = 80; enduranceScore = 40; athleticType = 'Power'; }
                    else if (f.genotype === 'TT') { powerScore = 40; enduranceScore = 80; athleticType = 'Endurance'; }
                }
            });
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div class="gauge-container">
                        <div class="gauge">
                            <svg viewBox="0 0 200 100">
                                <defs>
                                    <linearGradient id="gauge-gradient">
                                        <stop offset="0%" stop-color="#3b82f6"/>
                                        <stop offset="100%" stop-color="#dc2626"/>
                                    </linearGradient>
                                </defs>
                                <!-- Background arc -->
                                <path d="M 20 90 A 80 80 0 0 1 180 90" fill="none" stroke="var(--border-color)" stroke-width="12" stroke-linecap="round"/>
                                <!-- Value arc -->
                                <path d="M 20 90 A 80 80 0 0 1 180 90" fill="none" stroke="url(#gauge-gradient)" stroke-width="12" stroke-linecap="round"
                                    stroke-dasharray="${Math.PI * 80}" stroke-dashoffset="${Math.PI * 80 * (1 - powerScore/100)}"/>
                                <!-- Pointer -->
                                <circle cx="${100 + 70 * Math.cos(Math.PI - (Math.PI * powerScore/100))}" 
                                        cy="${90 - 70 * Math.sin(Math.PI * powerScore/100)}" 
                                        r="8" fill="var(--text-primary)"/>
                            </svg>
                            <div class="gauge-label">
                                <div class="gauge-value">${athleticType}</div>
                                <div class="gauge-title">Athletic Profile</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; width: 100%; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">
                            <span>ðŸš´ Endurance</span>
                            <span>Power ðŸ‹ï¸</span>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-secondary); border-radius: var(--radius); padding: 1.5rem;">
                        <h4 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem;">Training Recommendations</h4>
                        <ul style="list-style: none; font-size: 0.875rem;">
                            <li style="margin-bottom: 0.5rem;">âœ“ ${athleticType === 'Power' ? 'Focus on explosive, high-intensity training' : athleticType === 'Endurance' ? 'Prioritize aerobic base building' : 'Mix both power and endurance training'}</li>
                            <li style="margin-bottom: 0.5rem;">âœ“ Recovery time: ${athleticType === 'Power' ? '48-72 hours between intense sessions' : '24-48 hours between sessions'}</li>
                            <li>âœ“ ${athleticType === 'Endurance' ? 'Marathon, triathlon, cycling recommended' : athleticType === 'Power' ? 'Sprinting, weightlifting recommended' : 'Versatile - can excel in mixed sports'}</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // ========================================
        // UV/Skin Section
        // ========================================
        function renderSkin() {
            const container = document.getElementById('skin-info');
            
            // Extract skin-related data
            let skinType = 'Type II-III';
            let spfRec = '30+';
            let melanomaRisk = 'Average';
            
            const dermaFindings = data.dermatology?.findings || [];
            
            dermaFindings.forEach(f => {
                if (f.gene === 'MC1R' && f.risk_copies > 0) {
                    skinType = 'Type I-II (Fair)';
                    spfRec = '50+';
                    melanomaRisk = 'Elevated';
                }
            });
            
            // Skin type colors
            const skinColors = {
                'Type I': '#fce4d6', 'Type I-II': '#fde9d9', 'Type II': '#fef3e2',
                'Type II-III': '#fef9e7', 'Type III': '#fff8dc', 'Type IV': '#f5deb3',
                'Type V': '#d2b48c', 'Type VI': '#8b7355'
            };
            
            const skinColor = skinColors[skinType] || '#fef9e7';
            
            container.innerHTML = `
                <div class="skin-type-card">
                    <div class="skin-type-visual" style="background: ${skinColor}; border: 2px solid var(--border-color);"></div>
                    <h4>Estimated Skin Type</h4>
                    <p style="font-size: 1.25rem; font-weight: 600; margin: 0.5rem 0;">${skinType}</p>
                    <span class="badge ${melanomaRisk === 'Elevated' ? 'badge-warning' : 'badge-success'}">Melanoma Risk: ${melanomaRisk}</span>
                </div>
                <div class="spf-recommendation">
                    <div class="spf-value">SPF ${spfRec}</div>
                    <div class="spf-label">Recommended Protection</div>
                    <ul style="margin-top: 1rem; font-size: 0.875rem; text-align: left; padding-left: 1.25rem;">
                        <li>Apply 15-30 min before sun exposure</li>
                        <li>Reapply every 2 hours</li>
                        <li>Seek shade during peak hours (10am-4pm)</li>
                        ${melanomaRisk === 'Elevated' ? '<li><strong>Annual dermatology screening recommended</strong></li>' : ''}
                    </ul>
                </div>
            `;
        }
        
        // ========================================
        // Dietary Section
        // ========================================
        function renderDietary() {
            const container = document.getElementById('food-matrix');
            
            // Default dietary items
            const dietaryItems = [
                { name: 'Caffeine', icon: 'â˜•', status: 'good', note: 'Normal metabolism' },
                { name: 'Alcohol', icon: 'ðŸ·', status: 'moderate', note: 'Moderate tolerance' },
                { name: 'Lactose', icon: 'ðŸ¥›', status: 'good', note: 'Likely tolerant' },
                { name: 'Gluten', icon: 'ðŸž', status: 'good', note: 'No celiac markers' },
                { name: 'Saturated Fat', icon: 'ðŸ§ˆ', status: 'moderate', note: 'Limit intake' },
                { name: 'Bitter Taste', icon: 'ðŸ¥¬', status: 'good', note: 'Normal perception' }
            ];
            
            // Update based on actual data
            const nutritionFindings = data.nutrition?.findings || [];
            const traits = data.notable_traits || [];
            
            nutritionFindings.forEach(f => {
                const gene = f.gene || '';
                if (gene === 'LCT' && f.risk_copies > 0) {
                    const item = dietaryItems.find(d => d.name === 'Lactose');
                    if (item) { item.status = 'poor'; item.note = 'Likely intolerant'; }
                }
                if (gene === 'CYP1A2' && f.risk_copies > 0) {
                    const item = dietaryItems.find(d => d.name === 'Caffeine');
                    if (item) { item.status = 'moderate'; item.note = 'Slow metabolizer'; }
                }
            });
            
            container.innerHTML = dietaryItems.map(item => `
                <div class="food-item">
                    <span class="food-icon">${item.icon}</span>
                    <div class="food-info">
                        <h5>${item.name}</h5>
                        <p>${item.note}</p>
                    </div>
                    <div class="food-status ${item.status}"></div>
                </div>
            `).join('');
        }
        
        // ========================================
        // Utility Functions
        // ========================================
        function toggleCard(header) {
            header.parentElement.classList.toggle('collapsed');
        }
        
        function filterTable(tableId, query) {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll('tbody tr');
            const q = query.toLowerCase();
            
            rows.forEach(row => {
                const searchable = row.getAttribute('data-searchable') || row.textContent.toLowerCase();
                row.style.display = searchable.includes(q) ? '' : 'none';
            });
        }
        
        function formatConditionName(name) {
            return name
                .replace(/_/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase());
        }
        
        // Nav link highlighting
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Intersection observer for nav highlighting
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.toggle('active', link.getAttribute('href') === '#' + entry.target.id);
                    });
                }
            });
        }, { rootMargin: '-20% 0px -80% 0px' });
        
        sections.forEach(section => observer.observe(section));
    </script>
</body>
</html>
